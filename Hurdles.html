<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hurdles</title>
    <script src="Object.js"></script>
    <script src="Trail.js"></script>
    <script src="Ornament.js"></script>
    <script src="Cloud.js"></script>
    <script src="Stone.js"></script>
    <script src="Gecko.js"></script>
    <script src="StartGame.js"></script>
</head>
<body>
<div id="poit" style="font-size: 18px"></div>
<canvas id="myCanvas" width="1000px" height="350" style="border:1px solid chocolate"></canvas>
<script>
    let speed = 1;
    let point = 0;
    let timer = '';

    const canvas = document.getElementById('myCanvas');
    const ctx = canvas.getContext('2d');

    function LoadImg() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        let length2 = arrCloud.length;
        for (let t = 0; t < length2; t++) {
            if (arrCloud[t].x < -200) {
                arrCloud.splice(t, 1);
                length2--
            }
            if (arrCloud[t].status === 'left') {
                cloudImg.src = arrCloud[t].src;
                arrCloud[t].setX(-1 - (speed));
                ctx.drawImage(cloudImg, arrCloud[t].x, arrCloud[t].y, arrCloud[t].width, arrCloud[t].height);
            }
        }
        if (arrCloud[length2 - 1].x < 400) {
            style2++;
            cloud.setStyle(StyleCloud(style2));
            arrCloud.push({...cloud});
            if (style2 === 4) {
                style2 = 0;
            }
        }

        let length1 = arrTree.length;
        for (let j = 0; j < length1; j++) {
            // debugger;
            if (arrTree[j].x < -200) {
                arrTree.splice(j, 1);
                length1--
            }
            if (arrTree[j].status === 'left') {
                treeImg.src = arrTree[j].src;
                arrTree[j].setX(-4 - (speed));
                ctx.drawImage(treeImg, arrTree[j].x, arrTree[j].y, arrTree[j].width, arrTree[j].height);
            }
        }
        if (arrTree[length1 - 1].x < -50) {
            style1++;
            tree.setStyle(StyleCay(style1));
            arrTree.push({...tree});
            if (style1 === 5) {
                style1 = 0;
            }
        }

        let length = arrTrail.length;
        for (let i = 0; i < length; i++) {
            if (arrTrail[i].x < -340) {
                arrTrail.splice(i, 1);
                length--;
            }
            if (arrTrail[i].status === 'left') {
                trailImg.src = arrTrail[i].src;
                arrTrail[i].setX(-4 - (speed));
                ctx.drawImage(trailImg, arrTrail[i].x, arrTrail[i].y, arrTrail[i].width, arrTrail[i].height)
            }
        }
        if (arrTrail[length - 1].x + arrTrail[length - 1].width < 1310) {
            trail.setStyle(styleTrail);
            arrTrail.push({...trail});
        }

        let length3 = arrStone.length;
        for (let r = 0; r < length3; r++) {
            // debugger;
            if (arrStone[r].x < -200) {
                arrStone.splice(r, 1);
                length3--
                point++;
            }
            if (arrStone[r].status === 'left') {
                stoneImg.src = arrStone[r].src;
                arrStone[r].setX(-4 - (speed));
                ctx.drawImage(stoneImg, arrStone[r].x, arrStone[r].y, arrStone[r].width, arrStone[r].height);
            }
        }
        if (arrStone[length3 - 1].x < 142) {
            style3++;
            stone.setStyle(StyleStone(style3));
            arrStone.push({...stone});
            if (style3 === 11) {
                style3 = 0;
            }
        }

        if (gecko.status === 'run' && style4 % 2 === 0) {
            gecko.setStyle(StyleGecko(style4));
        }
        if (gecko.status === 'up') {
            // debugger;
            gecko.setTop(geckoTop);
            geckoTop = geckoTop - 6;
            if (gecko.y < 70) {
                geckoTop = gecko.y
                gecko.setStatus(1)
                gecko.setStyle(StyleGecko(98))
                // debugger;
            }
        }
        if (gecko.status === 'down') {
            gecko.setTop(geckoTop);
            geckoTop = geckoTop + 6;
            if (gecko.y >= 245) {
                style4 = 0;
                gecko.setStatus(3)
                gecko.setStyle(StyleGecko(style4));
            }
        }
        geckoImg.src = gecko.src;
        ctx.drawImage(geckoImg, gecko.x, gecko.y, gecko.width, gecko.height);
        style4 = style4 + 2;
        if (style4 === 60) {
            style4 = 0;
        }

        let gradient = ctx.createLinearGradient(0, 0, 50, 0);
        gradient.addColorStop("0", "magenta");
        gradient.addColorStop("0.5", "blue");
        gradient.addColorStop("1.0", "red");
        ctx.fillStyle = gradient;
        ctx.fillText("Point: " + point, 50, 60);

        speed = speed + 0.001;
        if (speed > 13) {
            speed = 13;
        }
        timer = setTimeout(LoadImg, 10);

        for (let z = 0; z < length3; z++) {
            if (arrStone[z].x <= (gecko.x + gecko.width) &&
                arrStone[z].x >= gecko.x &&
                arrStone[z].y <= (gecko.y + gecko.height) &&
                arrStone[z].y >= gecko.y) {

                clearTimeout(timer)
                StartGame(100);
                ctx.fillText("Game Over", 390, 220);
                break;
            }
            if (arrStone[z].x <= (gecko.x + gecko.width) &&
                arrStone[z].x >= gecko.x &&
                arrStone[z].y + (arrStone[z].height / 2) >= gecko.y &&
                arrStone[z].y + (arrStone[z].height / 2) <= gecko.y + gecko.height) {

                clearTimeout(timer)
                StartGame(100);
                ctx.fillText("Game Over", 390, 220);
                break;
            }
        }
    }

    StartGame(100);

    document.addEventListener('keyup', function (event) {
        if (event.keyCode === 32 && gecko.status !== 'down ') {
            geckoTop = gecko.y
            gecko.setStatus(1)
            gecko.setStyle(StyleGecko(94))
            gecko.setTop(geckoTop);
        }
    });
    document.addEventListener('keydown', function (event) {
        if (event.keyCode === 32 && gecko.status === 'run') {
            geckoTop = gecko.y
            gecko.setStatus(0)
            gecko.setStyle(StyleGecko(62))
        }
    });


</script>
</body>
</html>